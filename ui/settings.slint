// Nexus Settings UI Definition
// Modern, tabbed interface for application configuration

import { Button, VerticalBox, HorizontalBox, GroupBox, CheckBox, LineEdit, Slider } from "std-widgets.slint";

export component SettingsWindow inherits Window {
    title: "Nexus Settings";
    icon: @image-url("../installerassets/icon.png");
    preferred-width: 500px;
    preferred-height: 400px;
    background: #1a1a2e;
    default-font-family: "Segoe UI Variable";

    // Properties
    in-out property <int> active-tab: 0;
    
    // Config properties (bound to Rust state)
    in-out property <string> theme: "dark";
    in-out property <float> window-opacity: 0.96;
    in-out property <float> max-results: 8;
    in-out property <bool> run-on-startup: true;
    in-out property <bool> show-on-startup: false;
    in-out property <bool> fuzzy-search: true;
    in-out property <float> search-delay: 150;
    in-out property <float> font-size: 14;
    in-out property <string> window-size: "normal";
    in-out property <bool> auto-check-updates: true;
    in-out property <string> version-text: "v0.1.0";
    in-out property <string> update-status: "Your software is up to date";

    // Callbacks
    callback apply-clicked();
    callback reset-clicked();
    callback open-config-folder();
    callback check-updates();

    VerticalBox {
        padding: 0;
        spacing: 0;

        // Tab Header
        Rectangle {
            background: #1a1a2e;
            height: 45px;
            HorizontalBox {
                padding: 10px;
                spacing: 5px;

                Button {
                    text: "General";
                    primary: active-tab == 0;
                    clicked => { active-tab = 0; }
                }
                Button {
                    text: "Search";
                    primary: active-tab == 1;
                    clicked => { active-tab = 1; }
                }
                Button {
                    text: "Startup";
                    primary: active-tab == 2;
                    clicked => { active-tab = 2; }
                }
                Button {
                    text: "About";
                    primary: active-tab == 3;
                    clicked => { active-tab = 3; }
                }
                Button {
                    text: "Updates";
                    primary: active-tab == 4;
                    clicked => { active-tab = 4; }
                }
            }
        }

        // Content Area
        Rectangle {
            background: #161625;
            
            // General Tab
            if active-tab == 0 : VerticalBox {
                padding: 20px;
                spacing: 15px;

                GroupBox {
                    title: "Appearance";
                    VerticalBox {
                        spacing: 10px;
                        HorizontalBox {
                            Text { text: "Theme:"; vertical-alignment: center; color: white; width: 80px; }
                            // Simple toggle for now since we don't have ComboBox easily
                            Button { 
                                text: theme == "dark" ? "Dark" : "Light"; 
                                clicked => { theme = (theme == "dark" ? "light" : "dark"); }
                            }
                        }
                        
                        VerticalBox {
                            spacing: 5px;
                            HorizontalBox {
                                Text { text: "Window Opacity:"; color: white; }
                                Text { text: Math.round(window-opacity * 100) + "%"; color: #007ACC; }
                            }
                            Slider {
                                minimum: 0.5;
                                maximum: 1.0;
                                value <=> window-opacity;
                            }
                        }

                        VerticalBox {
                            spacing: 5px;
                            HorizontalBox {
                                Text { text: "Font Size:"; color: white; width: 80px; vertical-alignment: center; }
                                LineEdit { 
                                    text: "" + font-size;
                                    edited(val) => { font-size = val.to-float(); }
                                }
                            }
                        }
                        
                        HorizontalBox {
                            Text { text: "Window Size:"; vertical-alignment: center; color: white; width: 80px; }
                            Button { 
                                text: window-size == "compact" ? "Compact" : (window-size == "normal" ? "Normal" : "Large"); 
                                clicked => { 
                                    if (window-size == "compact") { window-size = "normal"; }
                                    else if (window-size == "normal") { window-size = "large"; }
                                    else { window-size = "compact"; }
                                }
                            }
                        }
                    }
                }
            }

            // Search Tab
            if active-tab == 1 : VerticalBox {
                padding: 20px;
                spacing: 15px;

                GroupBox {
                    title: "Search Behavior";
                    VerticalBox {
                        spacing: 10px;
                        HorizontalBox {
                            Text { text: "Max Results:"; vertical-alignment: center; color: white; width: 100px; }
                            LineEdit { 
                                text: "" + max-results;
                                edited(val) => { max-results = val.to-float(); }
                            }
                        }
                        
                        VerticalBox {
                            spacing: 5px;
                            HorizontalBox {
                                Text { text: "Search Delay:"; color: white; }
                                Text { text: search-delay + "ms"; color: #007ACC; }
                            }
                            Slider {
                                minimum: 50;
                                maximum: 1000;
                                value <=> search-delay;
                            }
                        }

                        CheckBox {
                            text: "Fuzzy Matching";
                            checked <=> fuzzy-search;
                        }
                    }
                }
            }

            // Startup Tab
            if active-tab == 2 : VerticalBox {
                padding: 20px;
                spacing: 15px;

                GroupBox {
                    title: "Startup & Behavior";
                    VerticalBox {
                        spacing: 10px;
                        CheckBox {
                            text: "Run at Windows startup";
                            checked <=> run-on-startup;
                        }
                        CheckBox {
                            text: "Show window on startup";
                            checked <=> show-on-startup;
                            enabled: run-on-startup;
                        }
                        Rectangle {
                            height: 60px;
                            background: #252535;
                            border-radius: 4px;
                            HorizontalBox {
                                padding: 8px;
                                Text {
                                    text: "Note: Nexus runs in the system tray when the window is hidden.";
                                    color: #CCCCCC;
                                    font-size: 12px;
                                    wrap: word-wrap;
                                }
                            }
                        }
                    }
                }
            }

            // About Tab
            if active-tab == 3 : VerticalBox {
                padding: 20px;
                spacing: 15px;
                alignment: start;

                Text {
                    text: "Nexus";
                    font-size: 24px;
                    font-weight: 700;
                    color: white;
                }
                Text {
                    text: version-text;
                    font-size: 14px;
                    color: #888;
                }
                
                Rectangle { height: 20px; } // Spacer
                
                Button {
                    text: "Open Configuration Folder";
                    clicked => { open-config-folder(); }
                }
                
                Rectangle { vertical-stretch: 1; } // Push to top
                
                Text {
                    text: "Â© 2024 Qwenzy. Released under MIT License.";
                    font-size: 12px;
                    color: #666;
                    horizontal-alignment: center;
                }
            }

            // Updates Tab
            if active-tab == 4 : VerticalBox {
                padding: 20px;
                spacing: 15px;
                alignment: start;

                GroupBox {
                    title: "Update Settings";
                    VerticalBox {
                        spacing: 10px;
                        CheckBox {
                            text: "Automatically check for updates";
                            checked <=> auto-check-updates;
                        }
                        
                        HorizontalBox {
                            spacing: 10px;
                            alignment: start;
                            Button {
                                text: "Check for Updates Now";
                                clicked => { check-updates(); }
                            }
                        }
                        
                        Rectangle { height: 10px; }
                        
                        Text {
                            text: update-status;
                            color: #AAAAAA;
                            font-size: 13px;
                        }
                    }
                }
            }
        }

        // Footer Actions
        Rectangle {
            background: #1a1a2e;
            height: 60px;
            HorizontalBox {
                padding: 15px;
                spacing: 10px;
                
                Button {
                    text: "Reset to Defaults";
                    clicked => { reset-clicked(); }
                }
                
                Rectangle { horizontal-stretch: 1; }
                
                Button {
                    text: "Apply";
                    primary: true;
                    clicked => { apply-clicked(); }
                }
                
                Button {
                    text: "Close";
                    clicked => { root.apply-clicked(); } // Just trigger apply or we need a close callback
                }
            }
        }
    }
}

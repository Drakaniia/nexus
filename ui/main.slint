// Windows Launcher - Slint UI Definition
// A lightweight, modern launcher with Mica/Acrylic aesthetics

import { VerticalBox, HorizontalBox, ListView } from "std-widgets.slint";
import { SettingsWindow } from "settings.slint";
export { SettingsWindow }

// Result item structure
export struct SearchResult {
    name: string,
    description: string,
    icon-path: string,
    result-type: string, // "app", "file", "action", "calc", "web"
}

// Main launcher component
export component Launcher inherits Window {
    // Window properties - borderless popup style
    no-frame: true;
    background: transparent;
    default-font-family: "Segoe UI Variable";
    default-font-size: 14px;
    
    // Properties
    in-out property <string> search-text: "";
    in-out property <[SearchResult]> results: [];
    in-out property <int> selected-index: 0;
    in-out property <bool> is-visible: true;
    
    // Callbacks
    callback search-changed(string);
    callback result-activated(int);
    callback escape-pressed();
    callback arrow-up();
    callback arrow-down();
    
    // Window sizing
    width: 680px;
    min-height: 70px;
    preferred-height: results.length > 0 ? 70px + (min(results.length, 6) * 56px) : 70px;
    
    // Main container with rounded corners and glass effect
    Rectangle {
        width: 100%;
        height: 100%;
        border-radius: 12px;
        background: #1a1a2e;
        opacity: 0.96;
        
        // Subtle border glow
        Rectangle {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            border-width: 1px;
            border-color: #ffffff20;
        }
        
        VerticalBox {
            padding: 16px;
            spacing: 8px;
            
            // Search input area
            Rectangle {
                height: 42px;
                border-radius: 8px;
                background: #ffffff10;
                
                HorizontalBox {
                    padding-left: 14px;
                    padding-right: 14px;
                    spacing: 12px;
                    
                    // Search icon
                    Text {
                        text: "üîç";
                        font-size: 18px;
                        vertical-alignment: center;
                    }
                    
                    // Text input
                    search-input := TextInput {
                        text <=> root.search-text;
                        font-size: 16px;
                        color: #ffffff;
                        selection-background-color: #6366f180;
                        selection-foreground-color: white;
                        vertical-alignment: center;
                        
                        edited => {
                            root.search-changed(self.text);
                        }
                        
                        accepted => {
                            if (root.results.length > 0) {
                                root.result-activated(root.selected-index);
                            }
                        }
                    }
                }
            }
            
            // Results list
            if results.length > 0 : Rectangle {
                vertical-stretch: 1;
                
                VerticalBox {
                    spacing: 4px;
                    
                    for result[index] in root.results : Rectangle {
                        height: 52px;
                        border-radius: 8px;
                        background: index == root.selected-index ? #6366f140 : transparent;
                        
                        animate background { duration: 150ms; easing: ease-out; }
                        
                        touch := TouchArea {
                            mouse-cursor: pointer;
                            
                            clicked => {
                                root.result-activated(index);
                            }
                        }
                        
                        HorizontalBox {
                            padding-left: 12px;
                            padding-right: 12px;
                            spacing: 12px;
                            
                            // Icon placeholder
                            Rectangle {
                                width: 36px;
                                height: 36px;
                                border-radius: 6px;
                                background: result.result-type == "app" ? #6366f130 :
                                           result.result-type == "file" ? #22c55e30 :
                                           result.result-type == "calc" ? #f59e0b30 :
                                           result.result-type == "web" ? #3b82f630 :
                                           #8b5cf630;
                                
                                Text {
                                    text: result.result-type == "app" ? "üì¶" :
                                          result.result-type == "file" ? "üìÑ" :
                                          result.result-type == "calc" ? "üî¢" :
                                          result.result-type == "web" ? "üåê" :
                                          "‚ö°";
                                    font-size: 18px;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }
                            }
                            
                            // Text content
                            VerticalBox {
                                spacing: 2px;
                                vertical-stretch: 1;
                                
                                Text {
                                    text: result.name;
                                    font-size: 14px;
                                    font-weight: 500;
                                    color: #ffffff;
                                    overflow: elide;
                                    vertical-alignment: center;
                                }
                                
                                Text {
                                    text: result.description;
                                    font-size: 12px;
                                    color: #ffffff80;
                                    overflow: elide;
                                    vertical-alignment: center;
                                }
                            }
                            
                            // Keyboard hint for selected item
                            if index == root.selected-index : Text {
                                text: "‚Üµ";
                                font-size: 14px;
                                color: #ffffff60;
                                vertical-alignment: center;
                            }
                        }
                    }
                }
            }
            
            // Empty state hint
            if results.length == 0 && search-text == "" : Text {
                text: "Type to search apps, files, or perform calculations...";
                font-size: 13px;
                color: #ffffff50;
                horizontal-alignment: center;
            }
        }
    }
    
    // Focus the input on show
    public function focus-input() {
        search-input.focus();
    }
    
    public function clear-search() {
        search-text = "";
        results = [];
        selected-index = 0;
    }
}
